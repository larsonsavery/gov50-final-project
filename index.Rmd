---
title: "Gov 50 Final Project"
author: "Larson Avery"
description: "Identifying demographic trends and variables that lead polls astray"
output:
  distill::distill_article:
    self_contained: false
---


## Project thoughts

Milestone 1:
I want to dive into data from a recent federal election, probably related to  House of Representatives races and compare polls leading up to the election with the actual results. I want to combine US Census data with polling to create a large dataset of demographic, economic, or geographic variables. Then I want to investigate if trends in these variables make polls accurate or inaccurate at predicting election outcomes.

Milestone 2:
Research Question: How did percentage of workers in the manufacturing sector, unemployment, and percent of households making under $15,000 a year affect the accuracy of polls in the 2016 Presidential election? Polls put Hillary Clinton ahead of Donald Trump and while he did not win the popular vote, he did win far more votes than expected due to the undercounting of voters. I want to explore how variables such as rural poverty, loss of manufacturing jobs, and unemployment—issues Trump emphasized—affected how accurate polls were for the 2016 Presidential Election. I hypothesize states with a higher manufacturing share, higher unemployment, and high proportions of poor households increases discrepancies between predicted and actual vote shares in FiveThirtyEight’s model. The explanatory variables are from a table on the US Census website that measure a variety of different economic variables. These are extremely recent and accurate as the Census reaches the vast majority of the US population. The outcome variable is the predicted popular vote for Trump by FiveThirtyEight (measured by aggregating many polls together) minus the final results of the popular vote by state. Each variable will be measured separately. A positive relationship between the variables and poll error with low standard deviation will support my hypothesis whereas a weak relationship or opposite relationship will disprove my hypothesis. 

Unfortunately at this time I have been unable to find FiveThirtyEight’s predicted popular vote share for 2016. I have found this dataset for 2020 on GitHub but a study of those results would be far less interesting as pollsters probably adjusted to polling for Trump between 2016 and 2020.



Demographic data: https://data.census.gov/cedsci/table?q=employment%20statistics&g=0100000US,%240400000&tid=ACSDP1Y2021.DP03&moe=false&tp=true

Election Polls: *need to find 2016 version
https://github.com/fivethirtyeight/data/tree/master/election-forecasts-2020 ->
https://projects.fivethirtyeight.com/2020-general-data/presidential_poll_averages_2020.csv

Election Results:
https://www.fec.gov/resources/cms-content/documents/federalelections2016.pdf

Milestone 3: 
I have completely pivoted to a new topic. Now I am investigating constitutional emergency powers enumeration and how it affects government liberality in the Post-Cold War world. So far I have created two graphs. See below.

Milestone 4: Topic Update:
My project focuses on constitutional provisions on states of emergency and they affect liberal principles such as tyranny of the state, tyranny of the majority, strong rule of law, protection of civil liberties an independent, judiciary, and effective checks and balances. I am most interested in whether or not having a state of emergency clause changes the liberal score and whether or not that state of emergency suspends or restricts rights changes the liberal score.

Hypothesis: 
1. Clausses allowing for states of emergency decrease liberal democracy,
Clauses that restrict or suspend rights during states of emergencies decrease liberal democracy.

Results: see tables at the bottom


---
title: "Constitutions"
output:
  pdf_document: default
  html_document: default
date: "2022-10-30"
---



## R Markdown

```{r}
library(tidyverse)
library(dplyr)
library(infer)
library(stringr)
library(broom)

```

```{r}
constitution <- read_csv("ccpcnc_v4_small.csv")
```


```{r}
constitution <- constitution |>
  drop_na(em) |>
  select(country, year, em, emrights, emdecl) |>
  filter(year > "1991")
```

```{r}
liberal <- read_csv("V-Dem_v3.csv")
```



```{r}
liberal <- liberal |>
  select(country_name, year, v2x_liberal, v2x_corr, e_regionpol_6C) |> #add e_regionpol_6C variable, not letting me select many new variables even ones listed above
  filter(year > "1991")
```

Finding differences in country names to prevent errors in `inner_join`
```{r}
#unique(liberal$country_name)
#unique(constitution$country)
```

Renaming Variables
```{r}
liberal <- liberal |>
  rename(country = country_name)
```



Using Stingr Package to standardize country names so they do not get dropped when the datasets merge:
```{r}
library(tidyverse)
library(dplyr)
library(stringr)
liberal <- liberal |>
  mutate(across('country', str_replace, 'Burma/Myanmar', 'Myanmar'),
         across('country', str_replace, 'The Gambia', 'Gambia'),
         across('country', str_replace, 'Republic of the Congo', 'Congo'))

liberal
```


##Filtering out duplicate data in `constitution`
```{r}
##This filters out all Serbia data, why isn't the "and" function (&) not working
constitution <- constitution |>
  filter(country != "Serbia" & year != "2006")  

```


## Left Join
```{r}
joined <- constitution |>
  left_join(liberal) |>
  select(country, year, v2x_liberal, em, emrights, emdecl, e_regionpol_6C) 
```



## Mutating `e_regionpol_6C` to give it descriptive region names.
```{r}
joined <- joined |>
  mutate(e_regionpol_6C = case_when(
    e_regionpol_6C == 1 ~ "Eastern Europe + Central Asia",
    e_regionpol_6C == 2 ~ "Latin America + Caribbean",
    e_regionpol_6C == 3 ~ "MENA",
    e_regionpol_6C == 4 ~ "Sub-Saharan Africa",
    e_regionpol_6C == 5 ~ "Western Europe + North America",
    e_regionpol_6C == 6 ~ "Asia + Pacific",
    em == 97 ~ "unknown")
  )
```



## Mutating Provision on State of Emergency Variable (em)

```{r}
joined <- joined |>
  mutate(em = case_when(
    em == 1 ~ "Provision",
    em == 2 ~ "No Provision",
    em == 96 ~ "other",
    em == 97 ~ "unknown"),
      ) |>
  mutate(em = str_remove(emrights))
 
```


```{r}
joined |>
  ggplot(aes(x = v2x_liberal)) +
  geom_histogram() +
  geom_vline(xintercept = 0.7379366) +
  geom_vline(xintercept = 0.6045941)
```



```{r}
provision_emerg <- joined |>
  group_by(em) |>
  summarize(mean_liberal = mean(v2x_liberal, na.rm = TRUE)) |>
  filter(!row_number() %in% (2))
provision_emerg
```




## Provision (em) Barplot


```{r}
provision_barplot <- provision_emerg |>
  ggplot(aes(x = em, y = mean_liberal)) +
  geom_bar(stat = "identity") +
  labs(x = "Provision on Calling a State of Emergency in the Constitution", 
       y = "V-Dem Liberal Index",
       title = "Effect of Having a Provision About States of Emergency on Liberality") 
ggsave("provision_barplot.png", provision_barplot) 


```
![](provision_barplot.png)







## Mutating Provision on State of Emergency Variable (emrights)


```{r}
joined <- joined |>
    mutate(emrights = case_when(
    emrights == 1 ~ "Suspension",
    emrights == 2 ~ "No Suspension",
    emrights == 96 ~ "Other",
    emrights == 97 ~ "unknown")) |>
    mutate(emrights = str_remove(emrights, "other"))
    
joined  
```



```{r}
provision_rights <- joined |>
  group_by(emrights) |>
  summarize(mean_liberal = mean(v2x_liberal, na.rm = TRUE)) |>
  filter(!row_number() %in% (2) )
provision_rights
```







## Suspension (emrights) Barplot

```{r}
suspension_barplot <- provision_rights |>
  ggplot(aes(x = emrights, y = mean_liberal)) +
  geom_bar(stat = "identity") +
  labs(x = "State of Emergency Clause Suspends/Restricts Rights", 
       y = "V-Dem Liberal Index",
       title = "Effect of Clause on Restricting/Suspending Rights during States of Emergency on Liberality")

ggsave("suspension_barplot.png", suspension_barplot)
```
![](suspension_barplot.png)






## Provision Regression: 




These results suggest that a strong casual relationship exists between countries having a provision in their constituions regarding states of emergency and their liberal score. Surprisingly, this constitutional characteristic actually increases the liberal score 13.334% relative to not having it. These results are likely statistically significant as the p-value is zero which rejects the null hyphotesis that their is no corrolation.


For this regression, how do I get ride of emOther so I can run a multiple regression with 
drop other cases from data, group them using mutate call create if_else, case_when, when its in these sets of values code them as missing
```{r}
suspension_lm <- lm(v2x_liberal ~ em, data = joined)

suspension_lm |>
  tidy() |>
  knitr::kable(caption = "Coefficient Estimates for State of Emergency Clause on Liberal Score",
               col.names = c("Predictor", "Estimate", "Std. Error", "Statistic", "P-value"),
               digits = c(0, 5, 3, 2, 3))

```




## Suspension/restriction Regression:



These results suggest that a strong casual relationship exists between countries having a provision in their constitutions suspending or restricting rights during a state of emergency and their liberal score. Surprisingly this constitutional characteristic actually increases the liberal score 13.342% relative to not having it. These results are likely statistically significant as the p-value is zero which rejects the null hyphotesis that their is no corrolation.



```{r}
suspension_lm <- lm(v2x_liberal ~ emrights, data = joined)

suspension_lm |>
  tidy() |>
  knitr::kable(caption = "Coefficient Estimates for Suspension of Rights on Liberal Score",
               col.names = c("Predictor", "Estimate", "Std. Error", "Statistic", "P-value"),
               digits = c(0, 5, 3, 2, 3))


#need to find potential cofounders
```
  

```{r}
big_lm <- lm(v2x_liberal ~ em + emrights, data = joined)
big_lm

#model_summary
```


